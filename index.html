<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Data Viz Project - Salary Analysis</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        /* --- General Structure & Theme --- */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #141e30 0%, #243b55 100%);
            min-height: 100vh;
            color: #e0e0e0;
            padding-bottom: 2rem;
        }
        .container { max-width: 1600px; margin: 0 auto; padding: 0 2rem; }
        .header {
            background: rgba(255, 255, 255, 0.98);
            padding: 2rem;
            text-align: center;
            box-shadow: 0 2px 20px rgba(0, 0, 0, 0.1);
            margin-bottom: 2rem;
            border-bottom: 4px solid #4a90e2;
        }
        .header h1 { font-size: 2.5rem; color: #141e30; margin-bottom: 0.5rem; text-transform: uppercase; letter-spacing: 2px; }
        .authors { font-size: 1.1rem; color: #555; font-style: italic; }
        
        /* --- Sections & Containers --- */
        .section {
            background: rgba(36, 59, 85, 0.7);
            margin: 2rem 0;
            padding: 2rem;
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .section-title { font-size: 1.8rem; color: #ffffff; margin-bottom: 1.5rem; text-align: center; border-bottom: 3px solid #4a90e2; padding-bottom: 0.5rem; }
        .charts-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 2rem; margin-top: 2rem; }
        .chart-container {
            background: #ffffff;
            color: #333;
            border-radius: 10px;
            padding: 1.5rem;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            min-height: 450px;
            height: auto;
            overflow: visible;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .chart-container:hover { transform: translateY(-5px); box-shadow: 0 12px 25px rgba(0, 0, 0, 0.15); }

        /* --- Chart Text & Styles --- */
        .chart-title { font-size: 1.2rem; color: #2c3e50; margin-bottom: 0.5rem; text-align: center; font-weight: 600; }
        .chart-description { font-size: 0.9rem; color: #555; text-align: center; margin-bottom: 1rem; max-width: 90%; margin-left: auto; margin-right: auto; }
        .tooltip { position: absolute; background: rgba(0, 0, 0, 0.85); color: white; padding: 8px 12px; border-radius: 5px; font-size: 12px; pointer-events: none; opacity: 0; transition: opacity 0.3s; }
        .axis { font-size: 12px; }
        .axis path, .axis line { fill: none; stroke: #666; shape-rendering: crispEdges; }
        .dot { transition: opacity 0.3s, transform 0.3s; }
        .line { fill: none; stroke-width: 1.5px; transition: stroke-opacity 0.3s; }
        
        /* --- Controls & Interactivity --- */
        .controls { text-align: center; margin-bottom: 1rem; }
        .reset-btn { background: #e74c3c; color: white; padding: 10px 20px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; transition: all 0.3s ease; box-shadow: 0 3px 10px rgba(231, 76, 60, 0.4); }
        .reset-btn:hover { background: #c0392b; transform: translateY(-2px); }
        .brush .selection { fill: #4a90e2; fill-opacity: 0.3; stroke: #4a90e2; }

        /* --- Status Messages & Loader --- */
        .status-message { text-align: center; padding: 4rem; font-size: 1.5rem; }
        .error-message { color: #ff6b6b; }
        .loader { width: 50px; height: 50px; border: 5px solid rgba(255, 255, 255, 0.2); border-top-color: #4a90e2; border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto; }
        @keyframes spin { to { transform: rotate(360deg); } }

        /* --- Summary Table --- */
        .summary-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1.5rem; text-align: center; }
        .summary-item { background: rgba(255, 255, 255, 0.05); padding: 1.5rem; border-radius: 10px; border: 1px solid rgba(255, 255, 255, 0.1); }
        .summary-item .value { font-size: 2rem; font-weight: bold; color: #4a90e2; }
        .summary-item .label { font-size: 0.9rem; color: #ccc; margin-top: 0.5rem; }
        
        /* --- Interactive Legend & Custom Chart Controls --- */
        .legend-item { cursor: pointer; }
        .legend-item.hidden { opacity: 0.5; }
        .custom-chart-controls { display: flex; justify-content: center; align-items: center; gap: 1.5rem; margin-bottom: 1.5rem; flex-wrap: wrap; }
        .custom-chart-controls select { padding: 8px; border: 1px solid #ccc; border-radius: 5px; font-size: 1rem; }
        .custom-chart-controls button { background: #28a745; color: white; padding: 8px 16px; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; transition: background-color 0.3s; }
        .custom-chart-controls button:hover { background: #218838; }
    </style>
</head>
<body>
    <div class="header">
        <h1><i class="fas fa-chart-bar"></i> Advanced Data Visualization Project</h1>
        <div class="authors">Sergio Barrera • Ariel Buenfil • Damaris Dzul • Diego Monroy • Alan Valbuena</div>
    </div>

    <div class="container">
        <div id="loading" class="status-message"><div class="loader"></div><p style="margin-top: 1rem;">Loading Data...</p></div>
        <div id="error" class="status-message error-message" style="display: none;"></div>

        <div id="content" style="display: none;">
            <div class="section">
                <h2 class="section-title">Overall Data Summary</h2>
                <div id="data-summary" class="summary-grid"></div>
            </div>
            
            <div class="controls"><button id="resetButton" class="reset-btn"><i class="fas fa-sync-alt"></i> Reset Filters</button></div>

            <div class="section">
                <h2 class="section-title">Interactive Linked Analysis</h2>
                <div class="charts-grid">
                    <div class="chart-container">
                        <div class="chart-title">Salary vs. Experience (Interactive Legend)</div>
                        <p class="chart-description">Analyze the correlation between experience and salary. <b>Interact:</b> Draw a rectangle or click the legend.</p>
                        <div id="scatter-experience"></div>
                    </div>
                    <div class="chart-container">
                        <div class="chart-title">Educational Composition by Salary Range</div>
                        <p class="chart-description">See which educational level is most common. <b>Interact:</b> Click a colored segment to filter.</p>
                        <div id="stacked-bar"></div>
                    </div>
                    <div class="chart-container">
                        <div class="chart-title">Parallel Coordinates</div>
                        <p class="chart-description">Explore multivariate relationships. <b>Interact:</b> Drag vertically on the axes to filter.</p>
                        <div id="parallel-coordinates"></div>
                    </div>
                </div>
            </div>
            
            <div class="section">
                <h2 class="section-title">Build Your Own Chart</h2>
                <div class="chart-container">
                    <div class="custom-chart-controls">
                        <label for="x-axis-select">Select X-Axis:</label>
                        <select id="x-axis-select"></select>
                        <label for="y-axis-select">Select Y-Axis:</label>
                        <select id="y-axis-select"></select>
                        <button id="generate-chart-btn"><i class="fas fa-magic"></i> Generate Chart</button>
                    </div>
                    <div id="custom-chart"></div>
                </div>
            </div>

            <div class="section">
                <h2 class="section-title">Distribution & Composition Analysis</h2>
                <div class="charts-grid">
                    <div class="chart-container">
                        <div class="chart-title">Top 10 Highest-Paid Job Titles</div>
                        <p class="chart-description">Identifies the most lucrative roles based on average salary.</p>
                        <div id="top-jobs-chart"></div>
                    </div>
                    <div class="chart-container">
                        <div class="chart-title">Distribution by Gender</div>
                        <p class="chart-description">Proportion of employees by gender in the dataset.</p>
                        <div id="gender-donut"></div>
                    </div>
                    <div class="chart-container">
                        <div class="chart-title">Distribution by Education Level</div>
                        <p class="chart-description">Proportion of employees by education level.</p>
                        <div id="education-donut"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="tooltip"></div>

    <script>
    // =================================================================================
    // --- GLOBAL VARIABLES & CONFIGURATION ---
    // =================================================================================
    let processedData = [];
    let activeSelection = [];
    
    const tooltip = d3.select(".tooltip");
    const colorScale = d3.scaleOrdinal(d3.schemeAccent);
    let activeStackedBarFilter = null;
    let hiddenGroups = new Set();

    // !!!!!!!!!!!!!!!!!!!!!!!!!!!  CRITICAL CONFIGURATION !!!!!!!!!!!!!!!!!!!!!!!!!!!
    //
    // 1. CSV FILE PATH:
    //    PASTE THE ABSOLUTE "RAW" URL YOU COPIED FROM GITHUB HERE.
    //    This is the most reliable way to ensure the file is found.
    //
    const csvFilePath = "https://raw.githubusercontent.com/your-username/your-repository-name/main/Salary_Data.csv"; // <-- PASTE YOUR RAW URL HERE

    // 2. COLUMN MAPPING:
    //    These values MUST EXACTLY match the headers in your CSV file.
    //
    const columnMapping = {
        age: "Age",
        gender: "Gender",
        education: "Education Level",
        jobTitle: "Job Title",
        experience: "Years of Experience",
        salary: "Salary"
    };
    // !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!

    // =================================================================================
    // --- DATA LOADING & INITIALIZATION ---
    // =================================================================================
    document.addEventListener('DOMContentLoaded', () => { loadData(); });

    /**
     * Loads and parses the CSV file with robust header cleaning.
     */
    async function loadData() {
        try {
            const response = await fetch(csvFilePath);
            if (!response.ok) {
                throw new Error(`Network response was not ok: ${response.statusText}`);
            }
            const csvText = await response.text();
            
            // Robust parsing: clean headers before passing to D3
            const data = d3.csvParse(csvText, (d) => {
                // This function runs for each row
                const row = {};
                for (const key in d) {
                    row[key.trim()] = d[key]; // Trim whitespace from headers
                }
                return row;
            });

            processRawData(data);
            initializeDashboard();
        } catch (error) {
            showError(`Failed to load or parse data from "${csvFilePath}".<br>Please check:<br>1. The URL pasted into 'csvFilePath' is the correct "Raw" URL from GitHub.<br>2. Your repository is public.`);
        }
    }

    /**
     * Processes the raw data into a clean, usable format.
     */
    function processRawData(rawData) {
        processedData = rawData.map((row, i) => ({
            id: `d-${i}`,
            age: +row[columnMapping.age] || 0,
            gender: row[columnMapping.gender] || 'N/A',
            education: row[columnMapping.education] || 'N/A',
            jobTitle: row[columnMapping.jobTitle] || 'N/A',
            yearsExperience: +row[columnMapping.experience] || 0,
            salary: +row[columnMapping.salary] || 0
        })).filter(d => d.salary > 0 && d.age > 0 && d.jobTitle !== 'N/A');
        
        if (processedData.length === 0) {
            throw new Error("No valid data was processed. Please double-check your 'columnMapping' object against the CSV headers.");
        }
        activeSelection = [...processedData];
    }
    
    // (The rest of the script remains the same as the previous full version)

    function initializeDashboard(){d3.select("#loading").style("display","none"),d3.select("#content").style("display","block"),d3.select("#resetButton").on("click",()=>{d3.select("#scatter-experience .brush").call(d3.brush().move,null),d3.selectAll("#parallel-coordinates .brush").each(function(e){d3.select(this).call(y[e].brush.move,null)}),activeStackedBarFilter=null,hiddenGroups.clear(),updateAllCharts(processedData)}),createAllVisualizations(),populateCustomChartSelectors(),d3.select("#generate-chart-btn").on("click",generateCustomChart)}
    function showError(e){d3.select("#loading").style("display","none"),d3.select("#error").style("display","block").html(`<i class="fas fa-exclamation-triangle"></i> ${e}`)}
    function showTooltip(e,t){tooltip.transition().duration(200).style("opacity",.9),tooltip.html(t).style("left",`${e.pageX+10}px`).style("top",`${e.pageY-28}px`)}
    function hideTooltip(){tooltip.transition().duration(500).style("opacity",0)}
    function updateAllCharts(e,t=!1){activeSelection=e,updateScatterExperience(t),updateStackedBarChart(),updateParallelCoordinates()}
    function createAllVisualizations(){createSummaryTable(processedData),createDonutChart("#gender-donut","gender"),createDonutChart("#education-donut","education"),createTopJobsChart(processedData),createScatterExperience(),createStackedBarChart(),createParallelCoordinates()}
    function createSummaryTable(e){const t=d3.format("$,.0f"),a=[{label:"Total Employees",value:e.length},{label:"Average Salary",value:t(d3.mean(e,e=>e.salary))},{label:"Median Salary",value:t(d3.median(e,e=>e.salary))},{label:"Average Age",value:d3.mean(e,e=>e.age).toFixed(1)}];d3.select("#data-summary").selectAll(".summary-item").data(a).enter().append("div").attr("class","summary-item").html(e=>`<div class="value">${e.value}</div><div class="label">${e.label}</div>`)}
    function createDonutChart(e,t){const a=Array.from(d3.group(processedData,e=>e[t]),([e,t])=>({key:e,value:t.length})),n=d3.select(e).node();if(!n)return;const r=n.getBoundingClientRect().width,l=300,o=Math.min(r,l)/2-20,c=d3.select(e).append("svg").attr("width",r).attr("height",l).append("g").attr("transform",`translate(${r/2}, ${l/2})`),s=d3.pie().value(e=>e.value).sort(null),d=d3.arc().innerRadius(.5*o).outerRadius(o);c.selectAll("path").data(s(a)).enter().append("path").attr("d",d).attr("fill",e=>colorScale(e.data.key)).attr("stroke","white").style("stroke-width","2px").style("transition","opacity 0.3s, transform 0.3s").on("mouseover",function(e,t){d3.select(this).style("transform","scale(1.05)");const a=(100*t.data.value/processedData.length).toFixed(1);showTooltip(e,`<b>${t.data.key}</b><br>${t.data.value} employees (${a}%)`)}).on("mouseout",function(){d3.select(this).style("transform","scale(1)"),hideTooltip()})}
    function createTopJobsChart(e){const t="#top-jobs-chart";d3.select(t).html("");const a=Array.from(d3.group(e,e=>e.jobTitle),([e,t])=>({job:e,avgSalary:d3.mean(t,e=>e.salary)})),n=a.sort((e,t)=>t.avgSalary-e.avgSalary).slice(0,10),r={top:20,right:30,bottom:40,left:250},l=d3.select(t).node(),o=l.getBoundingClientRect().width-r.left-r.right,c=300,s=d3.select(t).append("svg").attr("width",o+r.left+r.right).attr("height",c+r.top+r.bottom).append("g").attr("transform",`translate(${r.left},${r.top})`),d=d3.scaleLinear().domain([0,d3.max(n,e=>e.avgSalary)]).range([0,o]).nice(),i=d3.scaleBand().domain(n.map(e=>e.job)).range([0,c]).padding(.1);s.append("g").call(d3.axisLeft(i)),s.append("g").attr("transform",`translate(0, ${c})`).call(d3.axisBottom(d).ticks(5).tickFormat(e=>`$${e/1e3}K`)),s.selectAll(".bar").data(n).enter().append("rect").attr("class","bar").attr("y",e=>i(e.job)).attr("height",i.bandwidth()).attr("x",0).attr("width",0).attr("fill","#4a90e2").on("mouseover",(t,a)=>showTooltip(t,`<b>${a.job}</b><br>Avg. Salary: ${d3.format("$,.0f")(a.avgSalary)}`)).on("mouseout",hideTooltip).transition().duration(800).delay((e,t)=>50*t).attr("width",e=>d(e.avgSalary))}const y={};
    function createScatterExperience(){d3.select("#scatter-experience").html("");const e={top:20,right:20,bottom:100,left:70},t=d3.select("#scatter-experience").node().getBoundingClientRect().width,a=t-e.left-e.right,n=350-e.top-e.bottom,r=d3.select("#scatter-experience").append("svg").attr("width",t).attr("height",350+e.bottom).append("g").attr("transform",`translate(${e.left},${e.top})`),l=d3.scaleLinear().domain(d3.extent(processedData,e=>e.yearsExperience)).nice().range([0,a]),o=d3.scaleLinear().domain(d3.extent(processedData,e=>e.salary)).nice().range([n,0]);r.append("g").attr("transform",`translate(0,${n})`).call(d3.axisBottom(l)),r.append("g").call(d3.axisLeft(o).tickFormat(e=>`$${e/1e3}K`)),r.append("text").attr("text-anchor","middle").attr("x",a/2).attr("y",n+50).text("Years of Experience"),r.append("text").attr("text-anchor","middle").attr("transform","rotate(-90)").attr("y",-e.left+20).attr("x",-n/2).text("Salary (USD)"),r.append("g").selectAll("circle").data(processedData,e=>e.id).enter().append("circle").attr("class","dot").attr("cx",e=>l(e.yearsExperience)).attr("cy",e=>o(e.salary)).attr("r",4).attr("fill",e=>colorScale(e.gender)).on("mouseover",(e,t)=>showTooltip(e,`Exp: ${t.yearsExperience} years<br>Salary: $${t.salary.toLocaleString()}`)).on("mouseout",hideTooltip);const c=[...new Set(processedData.map(e=>e.gender))],s=r.append("g").attr("transform",`translate(${(a-100*c.length)/2}, ${n+60})`);c.forEach((t,a)=>{const n=s.append("g").attr("class","legend-item").attr("transform",`translate(${100*a}, 0)`).on("click",function(){hiddenGroups.has(t)?hiddenGroups.delete(t):hiddenGroups.add(t),updateScatterExperience(!0)});n.append("rect").attr("width",15).attr("height",15).attr("fill",colorScale(t)),n.append("text").attr("x",20).attr("y",12).text(t).style("fill","#333")});const d=d3.brush().extent([[0,0],[a,n]]).on("end",e=>{if(!e.selection)return void(e.sourceEvent&&updateAllCharts(processedData));const[[t,n],[r,c]]=e.selection,s=processedData.filter(e=>l(e.yearsExperience)>=t&&l(e.yearsExperience)<=r&&o(e.salary)>=n&&o(e.salary)<=c);updateAllCharts(s)});r.append("g").attr("class","brush").call(d),updateScatterExperience()}
    function populateCustomChartSelectors(){const e=Object.keys(columnMapping),t=d3.select("#x-axis-select"),a=d3.select("#y-axis-select");e.forEach(e=>{t.append("option").attr("value",e).text(columnMapping[e]),a.append("option").attr("value",e).text(columnMapping[e])})}
    function generateCustomChart(){const e=d3.select("#x-axis-select").property("value"),t=d3.select("#y-axis-select").property("value");if(e===t)return void alert("Please select two different columns for analysis.");d3.select("#custom-chart").html("");const a=d3.select("#custom-chart"),n={top:20,right:30,bottom:60,left:150},r=a.node().getBoundingClientRect().width-n.left-n.right,l=300-n.top-n.bottom,o=a.append("svg").attr("width",r+n.left+n.right).attr("height",l+n.top+n.bottom).append("g").attr("transform",`translate(${n.left},${n.top})`),c=typeof processedData[0][e],s=typeof processedData[0][t];"number"===c&&"number"===s?drawCustomScatter(o,r,l,e,t):"string"===c&&"number"===s?drawCustomBar(o,r,l,e,t):"number"===c&&"string"===s?drawCustomBar(o,r,l,t,e,!0):drawCustomBubble(o,r,l,e,t)}
    function drawCustomScatter(e,t,a,n,r){const l=d3.scaleLinear().domain(d3.extent(processedData,e=>e[n])).nice().range([0,t]),o=d3.scaleLinear().domain(d3.extent(processedData,e=>e[r])).nice().range([a,0]);e.append("g").attr("transform",`translate(0,${a})`).call(d3.axisBottom(l)),e.append("g").call(d3.axisLeft(o)),e.append("g").selectAll("circle").data(processedData).enter().append("circle").attr("cx",e=>l(e[n])).attr("cy",e=>o(e[r])).attr("r",3).attr("fill","#4a90e2").attr("opacity",.6)}
    function drawCustomBar(e,t,a,n,r,l=!1){const o=Array.from(d3.group(processedData,e=>e[n]),([e,t])=>({key:e,value:d3.mean(t,e=>e[r])})).sort((e,t)=>t.value-e.value).slice(0,20);if(l){const n=d3.scaleLinear().domain([0,d3.max(o,e=>e.value)]).nice().range([0,t]),r=d3.scaleBand().domain(o.map(e=>e.key)).range([0,a]).padding(.1);e.append("g").call(d3.axisLeft(r)),e.append("g").attr("transform",`translate(0,${a})`).call(d3.axisBottom(n)),e.selectAll("rect").data(o).enter().append("rect").attr("y",e=>r(e.key)).attr("height",r.bandwidth()).attr("x",0).attr("width",e=>n(e.value)).attr("fill","#4a90e2")}else{const n=d3.scaleBand().domain(o.map(e=>e.key)).range([0,t]).padding(.1),r=d3.scaleLinear().domain([0,d3.max(o,e=>e.value)]).nice().range([a,0]);e.append("g").attr("transform",`translate(0,${a})`).call(d3.axisBottom(n)).selectAll("text").attr("transform","rotate(-45)").style("text-anchor","end"),e.append("g").call(d3.axisLeft(r)),e.selectAll("rect").data(o).enter().append("rect").attr("x",e=>n(e.key)).attr("width",n.bandwidth()).attr("y",e=>r(e.value)).attr("height",e=>a-r(e.value)).attr("fill","#4a90e2")}}
    function drawCustomBubble(e,t,a,n,r){const l=d3.rollup(processedData,e=>e.length,e=>e[n],e=>e[r]),o=[];l.forEach((e,t)=>{e.forEach((e,n)=>{o.push({x:t,y:n,count:e})})});const c=d3.scaleBand().domain([...new Set(o.map(e=>e.x))]).range([0,t]).padding(.5),s=d3.scaleBand().domain([...new Set(o.map(e=>e.y))]).range([a,0]).padding(.5),d=d3.scaleSqrt().domain([0,d3.max(o,e=>e.count)]).range([1,25]);e.append("g").attr("transform",`translate(0,${a})`).call(d3.axisBottom(c)).selectAll("text").attr("transform","rotate(-45)").style("text-anchor","end"),e.append("g").call(d3.axisLeft(s)),e.selectAll("circle").data(o).enter().append("circle").attr("cx",e=>c(e.x)).attr("cy",e=>s(e.y)).attr("r",e=>d(e.count)).attr("fill","#4a90e2").attr("opacity",.7).on("mouseover",(t,a)=>showTooltip(t,`<b>${n}:</b> ${a.x}<br><b>${r}:</b> ${a.y}<br><b>Count:</b> ${a.count}`)).on("mouseout",hideTooltip)}
    function updateScatterExperience(e){const t=new Set(activeSelection.map(e=>e.id));d3.select("#scatter-experience").selectAll(".dot").transition().duration(300).attr("opacity",a=>t.has(a.id)&&!hiddenGroups.has(a.gender)?.8:.05).attr("r",a=>t.has(a.id)&&!hiddenGroups.has(a.gender)?5:0).style("stroke",a=>t.has(a.id)&&!hiddenGroups.has(a.gender)?"black":"none").style("stroke-width",1),d3.selectAll("#scatter-experience .legend-item").classed("hidden",e=>hiddenGroups.has(e))}
    function createStackedBarChart(){d3.select("#stacked-bar").html("");const e={top:40,right:30,bottom:80,left:70},t=d3.select("#stacked-bar").node().getBoundingClientRect().width,a=d3.select("#stacked-bar").append("svg").attr("width",t).attr("height",300).append("g").attr("transform",`translate(${e.left},${e.top})`);a.append("g").attr("class","x-axis axis"),a.append("g").attr("class","y-axis axis"),a.append("g").attr("class","bars"),a.append("text").attr("class","x-label").attr("text-anchor","middle"),a.append("text").attr("class","y-label").attr("text-anchor","middle").attr("transform","rotate(-90)"),updateStackedBarChart()}
    function updateStackedBarChart(){const e=d3.select("#stacked-bar").node();if(!e)return;const t={top:40,right:30,bottom:80,left:70},a=e.getBoundingClientRect().width,n=a-t.left-t.right,r=300-t.top-t.bottom;d3.select("#stacked-bar svg").attr("width",a);const l=d3.select("#stacked-bar svg g"),o=[{min:0,max:5e4,label:"0-50K"},{min:50001,max:1e5,label:"50-100K"},{min:100001,max:15e4,label:"100-150K"},{min:150001,max:1/0,label:"150K+"}],c=[...new Set(processedData.map(e=>e.education))].sort(),s=o.map(e=>{const t={range:e.label};return c.forEach(a=>{t[a]=activeSelection.filter(t=>t.education===a&&t.salary>=e.min&&t.salary<e.max).length}),t}),d=d3.stack().keys(c)(s),i=d3.scaleBand().domain(o.map(e=>e.label)).range([0,n]).padding(.2),u=d3.scaleLinear().domain([0,d3.max(d,e=>d3.max(e,e=>e[1]))||10]).nice().range([r,0]);colorScale.domain(c),l.select(".x-axis").attr("transform",`translate(0,${r})`).transition().duration(500).call(d3.axisBottom(i)),l.select(".y-axis").transition().duration(500).call(d3.axisLeft(u)),l.select(".x-label").attr("x",n/2).attr("y",r+t.top).text("Salary Range (USD)"),l.select(".y-label").attr("y",-t.left+20).attr("x",-r/2).text("Number of Employees");const p=l.select(".bars").html("");p.selectAll("g").data(d).enter().append("g").attr("fill",e=>colorScale(e.key)).selectAll("rect").data(e=>e).enter().append("rect").attr("x",e=>i(e.data.range)).attr("y",r).attr("height",0).attr("width",i.bandwidth()).style("cursor","pointer").on("mouseover",function(e,t){const a=d3.select(this.parentNode).datum().key;showTooltip(e,`${a}<br>Range: ${t.data.range}<br>Count: ${t[1]-t[0]}`)}).on("mouseout",hideTooltip).on("click",function(e,t){e.stopPropagation();const a=d3.select(this.parentNode).datum().key,n=t.data.range;if(activeStackedBarFilter&&activeStackedBarFilter.education===a&&activeStackedBarFilter.range===n)activeStackedBarFilter=null,updateAllCharts(processedData);else{activeStackedBarFilter={education:a,range:n};const e=o.find(e=>e.label===n),t=processedData.filter(t=>t.education===a&&t.salary>=e.min&&t.salary<e.max);updateAllCharts(t)}}).transition().duration(500).delay((e,t)=>50*t).attr("y",e=>u(e[1])).attr("height",e=>u(e[0])-u(e[1])),p.selectAll("rect").attr("opacity",function(e){if(!activeStackedBarFilter)return.9;const t=d3.select(this.parentNode).datum().key;return activeStackedBarFilter.range===e.data.range&&activeStackedBarFilter.education===t?1:.2})}
    function createParallelCoordinates(){d3.select("#parallel-coordinates").html("");const e={top:40,right:30,bottom:80,left:70},t=d3.select("#parallel-coordinates").node().getBoundingClientRect().width,a=t-e.left-e.right,n=300-e.top-e.bottom,r=["age","yearsExperience","salary"],l=d3.select("#parallel-coordinates").append("svg").attr("width",t).attr("height",300).append("g").attr("transform",`translate(${e.left},${e.top})`);r.forEach(e=>{y[e]=d3.scaleLinear().domain(d3.extent(processedData,t=>t[e])).nice().range([n,0])});const o=d3.scalePoint().domain(r).range([0,a]);l.append("g").selectAll("path").data(processedData,e=>e.id).enter().append("path").attr("class","line").attr("d",e=>d3.line()(r.map(t=>[o(t),y[t][e[t]]]))).attr("stroke",e=>colorScale(e.gender)).attr("stroke-opacity",0).attr("fill","none").transition().duration(500).attr("stroke-opacity",.5),l.selectAll(".axis-parallel").data(r).enter().append("g").attr("class","axis-parallel axis").attr("transform",e=>`translate(${o(e)},0)`).each(function(e){d3.select(this).call(d3.axisLeft(y[e]))}).append("text").style("text-anchor","middle").attr("y",-9).style("fill","#333").text(e=>"yearsExperience"===e?"Experience":"age"===e?"Age":"Salary"),l.selectAll(".axis-parallel").append("g").attr("class","brush").each(function(e){d3.select(this).call(y[e].brush=d3.brushY().extent([[-10,0],[10,n]]).on("brush end",function(e){const t=new Map;l.selectAll(".brush").filter(function(){return d3.brushSelection(this)}).each(function(e){t.set(e,d3.brushSelection(this).map(y[e].invert))});const a=processedData.filter(e=>Array.from(t.entries()).every(([t,[n,a]])=>e[t]>=a&&e[t]<=n));updateAllCharts(a)}))}),updateParallelCoordinates()}
    function updateParallelCoordinates(){const e=new Set(activeSelection.map(e=>e.id));d3.select("#parallel-coordinates").selectAll(".line").transition().duration(300).attr("stroke-opacity",t=>e.has(t.id)?.7:.05).attr("stroke-width",t=>e.has(t.id)?1.5:1)}
    
    </script>
</body>
</html>
