<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Data Viz Project - Salary Analysis</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        /* --- General Structure & Theme --- */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #141e30 0%, #243b55 100%);
            min-height: 100vh;
            color: #e0e0e0;
            padding-bottom: 2rem;
        }
        .container { max-width: 1600px; margin: 0 auto; padding: 0 2rem; }
        .header {
            background: rgba(255, 255, 255, 0.98);
            padding: 2rem;
            text-align: center;
            box-shadow: 0 2px 20px rgba(0, 0, 0, 0.1);
            margin-bottom: 2rem;
            border-bottom: 4px solid #4a90e2;
        }
        .header h1 { font-size: 2.5rem; color: #141e30; margin-bottom: 0.5rem; text-transform: uppercase; letter-spacing: 2px; }
        .authors { font-size: 1.1rem; color: #555; font-style: italic; }
        
        /* --- Sections & Containers --- */
        .section {
            background: rgba(36, 59, 85, 0.7);
            margin: 2rem 0;
            padding: 2rem;
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .section-title { font-size: 1.8rem; color: #ffffff; margin-bottom: 1.5rem; text-align: center; border-bottom: 3px solid #4a90e2; padding-bottom: 0.5rem; }
        .charts-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 2rem; margin-top: 2rem; }
        .chart-container {
            background: #ffffff;
            color: #333;
            border-radius: 10px;
            padding: 1.5rem;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            min-height: 450px;
            height: auto;
            overflow: visible;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .chart-container:hover { transform: translateY(-5px); box-shadow: 0 12px 25px rgba(0, 0, 0, 0.15); }

        /* --- Chart Text & Styles --- */
        .chart-title { font-size: 1.2rem; color: #2c3e50; margin-bottom: 0.5rem; text-align: center; font-weight: 600; }
        .chart-description { font-size: 0.9rem; color: #555; text-align: center; margin-bottom: 1rem; max-width: 90%; margin-left: auto; margin-right: auto; }
        .tooltip { position: absolute; background: rgba(0, 0, 0, 0.85); color: white; padding: 8px 12px; border-radius: 5px; font-size: 12px; pointer-events: none; opacity: 0; transition: opacity 0.3s; }
        .axis { font-size: 12px; }
        .axis path, .axis line { fill: none; stroke: #666; shape-rendering: crispEdges; }
        .dot { transition: opacity 0.3s, transform 0.3s; }
        .line { fill: none; stroke-width: 1.5px; transition: stroke-opacity 0.3s; }
        
        /* --- Controls & Interactivity --- */
        .controls { text-align: center; margin-bottom: 1rem; }
        .reset-btn { background: #e74c3c; color: white; padding: 10px 20px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; transition: all 0.3s ease; box-shadow: 0 3px 10px rgba(231, 76, 60, 0.4); }
        .reset-btn:hover { background: #c0392b; transform: translateY(-2px); }
        .brush .selection { fill: #4a90e2; fill-opacity: 0.3; stroke: #4a90e2; }

        /* --- Status Messages & Loader --- */
        .status-message { text-align: center; padding: 4rem; font-size: 1.5rem; }
        .error-message { color: #ff6b6b; }
        .loader { width: 50px; height: 50px; border: 5px solid rgba(255, 255, 255, 0.2); border-top-color: #4a90e2; border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto; }
        @keyframes spin { to { transform: rotate(360deg); } }

        /* --- Summary Table --- */
        .summary-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1.5rem; text-align: center; }
        .summary-item { background: rgba(255, 255, 255, 0.05); padding: 1.5rem; border-radius: 10px; border: 1px solid rgba(255, 255, 255, 0.1); }
        .summary-item .value { font-size: 2rem; font-weight: bold; color: #4a90e2; }
        .summary-item .label { font-size: 0.9rem; color: #ccc; margin-top: 0.5rem; }
        
        /* --- Interactive Legend --- */
        .legend-item { cursor: pointer; }
        .legend-item.hidden { opacity: 0.5; }
    </style>
</head>
<body>
    <div class="header">
        <h1><i class="fas fa-chart-bar"></i> Advanced Data Visualization Project</h1>
        <div class="authors">Sergio Barrera • Ariel Buenfil • Damaris Dzul • Diego Monroy • Alan Valbuena</div>
    </div>

    <div class="container">
        <div id="loading" class="status-message"><div class="loader"></div><p style="margin-top: 1rem;">Loading Data...</p></div>
        <div id="error" class="status-message error-message" style="display: none;"></div>

        <div id="content" style="display: none;">
            <div class="section">
                <h2 class="section-title">Overall Data Summary</h2>
                <div id="data-summary" class="summary-grid"></div>
            </div>
            
            <div class="controls"><button id="resetButton" class="reset-btn"><i class="fas fa-sync-alt"></i> Reset Filters</button></div>

            <div class="section">
                <h2 class="section-title">Interactive Linked Analysis</h2>
                <div class="charts-grid">
                    <div class="chart-container">
                        <div class="chart-title">Salary vs. Experience (Interactive Legend)</div>
                        <p class="chart-description">Analyze the correlation between experience and salary. <b>Interact:</b> Draw a rectangle or click the legend.</p>
                        <div id="scatter-experience"></div>
                    </div>
                    <div class="chart-container">
                        <div class="chart-title">Educational Composition by Salary Range</div>
                        <p class="chart-description">See which educational level is most common. <b>Interact:</b> Click a colored segment to filter.</p>
                        <div id="stacked-bar"></div>
                    </div>
                    <div class="chart-container">
                        <div class="chart-title">Parallel Coordinates</div>
                        <p class="chart-description">Explore multivariate relationships. <b>Interact:</b> Drag vertically on the axes to filter.</p>
                        <div id="parallel-coordinates"></div>
                    </div>
                </div>
            </div>
            
            <div class="section">
                <h2 class="section-title">Distribution & Composition Analysis</h2>
                <div class="charts-grid">
                    <div class="chart-container">
                        <div class="chart-title">Top 10 Highest-Paid Job Titles</div>
                        <p class="chart-description">Identifies the most lucrative roles based on average salary.</p>
                        <div id="top-jobs-chart"></div>
                    </div>
                    <div class="chart-container">
                        <div class="chart-title">Distribution by Gender</div>
                        <p class="chart-description">Proportion of employees by gender in the dataset.</p>
                        <div id="gender-donut"></div>
                    </div>
                    <div class="chart-container">
                        <div class="chart-title">Distribution by Education Level</div>
                        <p class="chart-description">Proportion of employees by education level.</p>
                        <div id="education-donut"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="tooltip"></div>

    <script>
    // =================================================================================
    // --- GLOBAL VARIABLES & CONFIGURATION ---
    // =================================================================================
    let processedData = [];
    let activeSelection = [];
    
    const margin = { top: 40, right: 30, bottom: 80, left: 70 };
    const tooltip = d3.select(".tooltip");
    const colorScale = d3.scaleOrdinal(d3.schemeAccent);
    let activeStackedBarFilter = null;
    let hiddenGroups = new Set();

    // !!!!!!!!!!!!!!!!!!!!!!!!!!!  CRITICAL CONFIGURATION !!!!!!!!!!!!!!!!!!!!!!!!!!!
    //
    // The filename below MUST EXACTLY MATCH your file in the GitHub repository.
    // GitHub is case-sensitive: "Salary_Data.csv" is NOT the same as "salary_data.csv".
    // Using "./" is a best practice for relative paths.
    //
    // !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
    const csvFilePath = "./Salary_Data.csv"; 

    // Column mapping: Adjust the values to match your CSV headers exactly.
    const columnMapping = {
        age: "Age",
        gender: "Gender",
        education: "Education Level",
        jobTitle: "Job Title",
        experience: "Years of Experience",
        salary: "Salary"
    };

    // =================================================================================
    // --- DATA LOADING & INITIALIZATION ---
    // =================================================================================
    document.addEventListener('DOMContentLoaded', () => { loadData(); });

    /**
     * Loads the CSV file and handles success or failure.
     */
    function loadData() {
        d3.csv(csvFilePath).then(data => {
            processRawData(data);
            initializeDashboard();
        }).catch(error => {
            showError(`Failed to load data from "${csvFilePath}".<br>Please check these two things:<br>1. The filename in the code is an exact, case-sensitive match to your file in the GitHub repository.<br>2. The file is located in the same directory as this index.html file.`);
        });
    }

    /**
     * Processes the raw CSV data into a clean, usable format.
     * @param {Array} rawData - Data directly from d3.csv.
     */
    function processRawData(rawData) {
        processedData = rawData.map((row, i) => ({
            id: `d-${i}`,
            age: +row[columnMapping.age] || 0,
            gender: row[columnMapping.gender] || 'N/A',
            education: row[columnMapping.education] || 'N/A',
            jobTitle: row[columnMapping.jobTitle] || 'N/A',
            yearsExperience: +row[columnMapping.experience] || 0,
            salary: +row[columnMapping.salary] || 0
        })).filter(d => d.salary > 0 && d.gender !== 'N/A');
        activeSelection = [...processedData];
    }

    /**
     * Sets up the dashboard once data is ready.
     */
    function initializeDashboard() {
        d3.select("#loading").style("display", "none");
        d3.select("#content").style("display", "block");
        
        d3.select("#resetButton").on("click", () => {
            d3.select("#scatter-experience .brush").call(d3.brush().move, null);
            d3.selectAll("#parallel-coordinates .brush").each(function(d) { d3.select(this).call(y[d].brush.move, null); });
            activeStackedBarFilter = null;
            hiddenGroups.clear();
            updateAllCharts(processedData);
        });
        
        createAllVisualizations();
    }
    
    // =================================================================================
    // --- UTILITY FUNCTIONS ---
    // =================================================================================
    function showError(message) { d3.select("#loading").style("display", "none"); d3.select("#error").style("display", "block").html(`<i class="fas fa-exclamation-triangle"></i> ${message}`); }
    function showTooltip(event, text) { tooltip.transition().duration(200).style("opacity", .9); tooltip.html(text).style("left", `${event.pageX + 10}px`).style("top", `${event.pageY - 28}px`); }
    function hideTooltip() { tooltip.transition().duration(500).style("opacity", 0); }

    // =================================================================================
    // --- MASTER CHARTING LOGIC ---
    // =================================================================================
    function updateAllCharts(data, preserveHiddenGroups = false) {
        activeSelection = data;
        updateScatterExperience(preserveHiddenGroups);
        updateStackedBarChart();
        updateParallelCoordinates();
    }

    function createAllVisualizations() {
        createSummaryTable(processedData);
        createDonutChart("#gender-donut", "gender", "By Gender");
        createDonutChart("#education-donut", "education", "By Education Level");
        createTopJobsChart(processedData);
        createScatterExperience();
        createStackedBarChart();
        createParallelCoordinates();
    }
    
    // =================================================================================
    // --- NEW VISUALIZATIONS ---
    // =================================================================================
    function createSummaryTable(data) {
        const formatCurrency = d3.format("$,.0f");
        const summaryData = [
            { label: "Total Employees", value: data.length },
            { label: "Average Salary", value: formatCurrency(d3.mean(data, d => d.salary)) },
            { label: "Median Salary", value: formatCurrency(d3.median(data, d => d.salary)) },
            { label: "Average Age", value: d3.mean(data, d => d.age).toFixed(1) }
        ];
        d3.select("#data-summary").selectAll(".summary-item").data(summaryData).enter().append("div")
            .attr("class", "summary-item").html(d => `<div class="value">${d.value}</div><div class="label">${d.label}</div>`);
    }
    
    function createDonutChart(containerId, groupByKey) {
        const groupedData = Array.from(d3.group(processedData, d => d[groupByKey]), ([key, value]) => ({key, value: value.length}));
        const containerNode = d3.select(containerId).node();
        if(!containerNode) return;
        const width = containerNode.getBoundingClientRect().width;
        const height = 300;
        const radius = Math.min(width, height) / 2 - 20;
        const svg = d3.select(containerId).append("svg").attr("width", width).attr("height", height)
            .append("g").attr("transform", `translate(${width / 2}, ${height / 2})`);
        const pie = d3.pie().value(d => d.value).sort(null);
        const arc = d3.arc().innerRadius(radius * 0.5).outerRadius(radius);
        svg.selectAll("path").data(pie(groupedData)).enter().append("path").attr("d", arc)
            .attr("fill", d => colorScale(d.data.key)).attr("stroke", "white").style("stroke-width", "2px")
            .style("transition", "opacity 0.3s, transform 0.3s")
            .on("mouseover", function(event, d) {
                d3.select(this).style("transform", "scale(1.05)");
                const percent = (d.data.value / processedData.length * 100).toFixed(1);
                showTooltip(event, `<b>${d.data.key}</b><br>${d.data.value} employees (${percent}%)`);
            })
            .on("mouseout", function() { d3.select(this).style("transform", "scale(1)"); hideTooltip(); });
    }
    
    function createTopJobsChart(data) {
        const containerId = "#top-jobs-chart";
        d3.select(containerId).html("");
        const avgSalaryByJob = Array.from(d3.group(data, d => d.jobTitle), ([key, value]) => ({ job: key, avgSalary: d3.mean(value, d => d.salary) }));
        const top10Jobs = avgSalaryByJob.sort((a, b) => b.avgSalary - a.avgSalary).slice(0, 10);
        const containerNode = d3.select(containerId).node();
        const width = containerNode.getBoundingClientRect().width - margin.left - margin.right;
        const height = 300;
        const svg = d3.select(containerId).append("svg").attr("width", width + margin.left + margin.right).attr("height", height + margin.top + margin.bottom).append("g").attr("transform", `translate(${margin.left},${margin.top})`);
        const x = d3.scaleLinear().domain([0, d3.max(top10Jobs, d => d.avgSalary)]).range([0, width]);
        const y = d3.scaleBand().domain(top10Jobs.map(d => d.job)).range([0, height]).padding(0.1);
        svg.append("g").call(d3.axisLeft(y));
        svg.append("g").attr("transform", `translate(0, ${height})`).call(d3.axisBottom(x).ticks(5).tickFormat(d => `$${d/1000}K`));
        svg.selectAll(".bar").data(top10Jobs).enter().append("rect").attr("class", "bar").attr("y", d => y(d.job)).attr("height", y.bandwidth()).attr("x", 0).attr("width", 0)
            .attr("fill", "#4a90e2").on("mouseover", (e, d) => showTooltip(e, `<b>${d.job}</b><br>Avg. Salary: ${d3.format("$,.0f")(d.avgSalary)}`)).on("mouseout", hideTooltip)
            .transition().duration(800).delay((d, i) => i * 50).attr("width", d => x(d.avgSalary));
    }

    // =================================================================================
    // --- INTERACTIVE LINKED CHARTS ---
    // =================================================================================
    const y = {}; // Global for reset
    // The rest of the charting functions are the same and correct.
    function createScatterExperience() { d3.select("#scatter-experience").html(""); const t = d3.select("#scatter-experience").node().getBoundingClientRect().width; const e = t - margin.left - margin.right; const n = 300 - margin.top - margin.bottom; const a = d3.select("#scatter-experience").append("svg").attr("width", t).attr("height", 300 + margin.bottom).append("g").attr("transform", `translate(${margin.left},${margin.top})`); const r = d3.scaleLinear().domain(d3.extent(processedData, (t) => t.yearsExperience)).nice().range([0, e]); const o = d3.scaleLinear().domain(d3.extent(processedData, (t) => t.salary)).nice().range([n, 0]); a.append("g").attr("class", "x-axis axis").attr("transform", `translate(0,${n})`).call(d3.axisBottom(r)), a.append("g").attr("class", "y-axis axis").call(d3.axisLeft(o).tickFormat((t) => `$${t / 1e3}K`)), a.append("text").attr("text-anchor", "middle").attr("x", e / 2).attr("y", n + 50).text("Years of Experience"), a.append("text").attr("text-anchor", "middle").attr("transform", "rotate(-90)").attr("y", -margin.left + 20).attr("x", -n / 2).text("Salary (USD)"); const i = a.append("g").selectAll("circle").data(processedData, (t) => t.id); i.enter().append("circle").attr("class", "dot").attr("cx", (t) => r(t.yearsExperience)).attr("cy", (t) => o(t.salary)).attr("r", 0).attr("fill", (t) => colorScale(t.gender)).on("mouseover", (t, e) => showTooltip(t, `Exp: ${e.yearsExperience} years<br>Salary: $${e.salary.toLocaleString()}<br>Gender: ${e.gender}`)).on("mouseout", hideTooltip).transition().duration(500).delay((t, e) => 2 * e).attr("r", 4); const c = a.append("g").attr("transform", `translate(${e - 100}, 0)`); [...new Set(processedData.map((t) => t.gender))].forEach((t, e) => { const n = c.append("g").attr("class", "legend-item").attr("transform", `translate(0, ${20 * e})`).on("click", function () { hiddenGroups.has(t) ? hiddenGroups.delete(t) : hiddenGroups.add(t), updateScatterExperience(!0); }); n.append("rect").attr("width", 15).attr("height", 15).attr("fill", colorScale(t)), n.append("text").attr("x", 20).attr("y", 12).text(t); }); const l = d3.brush().extent([[0, 0], [e, n]]).on("end", (t) => { if (t.selection) { const [[n, a], [i, c]] = t.selection, l = processedData.filter((t) => r(t.yearsExperience) >= n && r(t.yearsExperience) <= i && o(t.salary) >= a && o(t.salary) <= c); updateAllCharts(l); } else t.sourceEvent && updateAllCharts(processedData); }); a.append("g").attr("class", "brush").call(l), updateScatterExperience(); }
    function updateScatterExperience() { const t = new Set(activeSelection.map((t) => t.id)); d3.select("#scatter-experience").selectAll(".dot").transition().duration(300).attr("opacity", (e) => t.has(e.id) && !hiddenGroups.has(e.gender) ? 0.8 : 0.05).attr("r", (e) => t.has(e.id) && !hiddenGroups.has(e.gender) ? 5 : 0).style("stroke", (e) => t.has(e.id) && !hiddenGroups.has(e.gender) ? "black" : "none").style("stroke-width", 1), d3.selectAll("#scatter-experience .legend-item").classed("hidden", (t) => hiddenGroups.has(d3.select(this).text())); }
    function createStackedBarChart() { d3.select("#stacked-bar").html(""); const t = d3.select("#stacked-bar").node().getBoundingClientRect().width, e = d3.select("#stacked-bar").append("svg").attr("width", t).attr("height", 300).append("g").attr("transform", `translate(${margin.left},${margin.top})`); e.append("g").attr("class", "x-axis axis"), e.append("g").attr("class", "y-axis axis"), e.append("g").attr("class", "bars"), e.append("text").attr("class", "x-label").attr("text-anchor", "middle"), e.append("text").attr("class", "y-label").attr("text-anchor", "middle").attr("transform", "rotate(-90)"), updateStackedBarChart(); }
    function updateStackedBarChart() { const t = d3.select("#stacked-bar").node(); if (!t) return; const e = t.getBoundingClientRect().width, n = e - margin.left - margin.right, a = 300 - margin.top - margin.bottom; d3.select("#stacked-bar svg").attr("width", e); const r = d3.select("#stacked-bar svg g"), o = [{ min: 0, max: 5e4, label: "0-50K" }, { min: 50001, max: 1e5, label: "50-100K" }, { min: 100001, max: 15e4, label: "100-150K" }, { min: 150001, max: 1 / 0, label: "150K+" },], i = [...new Set(processedData.map((t) => t.education))].sort(), c = o.map((t) => { const e = { range: t.label }; return ( i.forEach((n) => { e[n] = activeSelection.filter( (e) => e.education === n && e.salary >= t.min && e.salary < t.max ).length; }), e ); }), l = d3.stack().keys(i)(c), s = d3.scaleBand().domain(o.map((t) => t.label)).range([0, n]).padding(0.2), d = d3.scaleLinear().domain([0, d3.max(l, (t) => d3.max(t, (t) => t[1])) || 10,]).nice().range([a, 0]); colorScale.domain(i), r.select(".x-axis").attr("transform", `translate(0,${a})`).transition().duration(500).call(d3.axisBottom(s)), r.select(".y-axis").transition().duration(500).call(d3.axisLeft(d)), r.select(".x-label").attr("x", n / 2).attr("y", a + margin.top).text("Salary Range (USD)"), r.select(".y-label").attr("y", -margin.left + 20).attr("x", -a / 2).text("Number of Employees"); const u = r.select(".bars").html(""); u.selectAll("g").data(l).enter().append("g").attr("fill", (t) => colorScale(t.key)).selectAll("rect").data((t) => t).enter().append("rect").attr("x", (t) => s(t.data.range)).attr("y", a).attr("height", 0).attr("width", s.bandwidth()).style("cursor", "pointer").on("mouseover", function (t, e) { const n = d3.select(this.parentNode).datum().key; showTooltip( t, `${n}<br>Range: ${e.data.range}<br>Count: ${e[1] - e[0]}` ); }).on("mouseout", hideTooltip).on("click", function (t, e) { t.stopPropagation(); const n = d3.select(this.parentNode).datum().key, a = e.data.range; if ( activeStackedBarFilter && activeStackedBarFilter.education === n && activeStackedBarFilter.range === a ) (activeStackedBarFilter = null), updateAllCharts(processedData); else { activeStackedBarFilter = { education: n, range: a }; const t = o.find((t) => t.label === a), i = processedData.filter( (e) => e.education === n && e.salary >= t.min && e.salary < t.max ); updateAllCharts(i); } }).transition().duration(500).delay((t, e) => 50 * e).attr("y", (t) => d(t[1])).attr("height", (t) => d(t[0]) - d(t[1])), u.selectAll("rect").attr("opacity", function (t) { if (!activeStackedBarFilter) return 0.9; const e = d3.select(this.parentNode).datum().key; return activeStackedBarFilter.range === t.data.range && activeStackedBarFilter.education === e ? 1 : 0.2; }); }
    function createParallelCoordinates() { d3.select("#parallel-coordinates").html(""); const t = d3.select("#parallel-coordinates").node().getBoundingClientRect().width, e = t - margin.left - margin.right, n = 300 - margin.top - margin.bottom, a = ["age", "yearsExperience", "salary"], r = d3.select("#parallel-coordinates").append("svg").attr("width", t).attr("height", 300).append("g").attr("transform", `translate(${margin.left},${margin.top})`); a.forEach((t) => { y[t] = d3.scaleLinear().domain(d3.extent(processedData, (e) => e[t])).nice().range([n, 0]); }); const o = d3.scalePoint().domain(a).range([0, e]); r.append("g").selectAll("path").data(processedData, (t) => t.id).enter().append("path").attr("class", "line").attr("d", (t) => d3.line()(a.map((e) => [o(e), y[e](t[e])]))).attr("stroke", (t) => colorScale(t.gender)).attr("stroke-opacity", 0).attr("fill", "none").transition().duration(500).attr("stroke-opacity", 0.5), r.selectAll(".axis-parallel").data(a).enter().append("g").attr("class", "axis-parallel axis").attr("transform", (t) => `translate(${o(t)},0)`).each(function (t) { d3.select(this).call(d3.axisLeft(y[t])); }).append("text").style("text-anchor", "middle").attr("y", -9).style("fill", "#333").text((t) => "yearsExperience" === t ? "Experience" : "age" === t ? "Age" : "Salary"), r.selectAll(".axis-parallel").append("g").attr("class", "brush").each(function (t) { d3.select(this).call( (y[t].brush = d3.brushY().extent([[-10, 0], [10, n],]).on("brush end", function () { const t = new Map(); r.selectAll(".brush").filter(function (t) { return d3.brushSelection(this); }).each(function (t) { selections.set(d,d3.brushSelection(this).map(y[d].invert)); }); const e = processedData.filter((t) => Array.from(selections.entries()).every( ([e, [n, a]]) => t[e] >= a && t[e] <= n ) ); updateAllCharts(e); })) ); }), updateParallelCoordinates(); }
    function updateParallelCoordinates() { const t = new Set(activeSelection.map((t) => t.id)); d3.select("#parallel-coordinates").selectAll(".line").transition().duration(300).attr("stroke-opacity", (e) => (t.has(e.id) ? 0.7 : 0.05)).attr("stroke-width", (e) => (t.has(e.id) ? 1.5 : 1)); }
    </script>
</body>
</html>
